# å¤§æ’ç›¸æœºç¡¬è§¦å‘åŠŸèƒ½ - ä¿®æ”¹æ€»ç»“

## âœ… å®ŒæˆçŠ¶æ€

æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶é€šè¿‡ç¼–è¯‘æµ‹è¯•ã€‚

---

## ğŸ“¦ äº¤ä»˜å†…å®¹

### 1. æ ¸å¿ƒåŠŸèƒ½ä»£ç 
- âœ… `io/daheng.hpp` - æ·»åŠ ç¡¬è§¦å‘æˆå‘˜å˜é‡
- âœ… `io/daheng.cpp` - å®ç°ç¡¬è§¦å‘é…ç½®é€»è¾‘ï¼ˆ330-433è¡Œï¼‰

### 2. é…ç½®æ–‡ä»¶
- âœ… `configs/daheng.yaml` - æ·»åŠ è§¦å‘å‚æ•°é…ç½®ï¼ˆ60-73è¡Œï¼‰

### 3. æµ‹è¯•ç¨‹åº
- âœ… `tests/trigger_test.cpp` - ç¡¬è§¦å‘æµ‹è¯•ç¨‹åºï¼ˆå…¨æ–°ï¼‰
- âœ… `CMakeLists.txt` - æ·»åŠ æµ‹è¯•ç¨‹åºç¼–è¯‘é…ç½®

### 4. æ–‡æ¡£
- âœ… `docs/TRIGGER_GUIDE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼ˆ310è¡Œï¼‰
- âœ… `docs/TRIGGER_IMPLEMENTATION.md` - å®ç°è¯´æ˜æ–‡æ¡£

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ”¯æŒçš„è§¦å‘æ¨¡å¼
- [x] è¿ç»­é‡‡é›†æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
- [x] ç¡¬è§¦å‘æ¨¡å¼ï¼ˆå¤–éƒ¨GPIOè§¦å‘ï¼‰

### å¯é…ç½®å‚æ•°
| å‚æ•° | ç±»å‹ | å¯é€‰å€¼ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|--------|------|
| `trigger_enable` | bool | true/false | false | æ˜¯å¦å¯ç”¨ç¡¬è§¦å‘ |
| `trigger_source` | int | 0/1/2 | 2 | è§¦å‘æºGPIO (Line0/1/2) |
| `trigger_activation` | int | 0/1 | 0 | è§¦å‘æ²¿ (0=ä¸Šå‡æ²¿, 1=ä¸‹é™æ²¿) |

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿé…ç½®

**1. å¯ç”¨ç¡¬è§¦å‘** (`configs/daheng.yaml`):
```yaml
trigger_enable: true      # å¯ç”¨
trigger_source: 2         # Line2
trigger_activation: 0     # ä¸Šå‡æ²¿
```

**2. ç¡¬ä»¶è¿æ¥**:
```
è§¦å‘è®¾å¤‡ GPIO â†’ ç›¸æœº Line2 (Pin 3)
è§¦å‘è®¾å¤‡ GND  â†’ ç›¸æœº GND  (Pin 4)
```

**3. è¿è¡Œç¨‹åº**:
```bash
./build/standard              # æ­£å¸¸è‡ªç„ç¨‹åº
./build/trigger_test          # æµ‹è¯•ç¨‹åº
```

---

## ğŸ“Š ç¼–è¯‘çŠ¶æ€

```bash
# ä¸»ç¨‹åº
[âœ“] standard          (2.3 MB)
[âœ“] mt_standard
[âœ“] standard_mpc
...

# æµ‹è¯•ç¨‹åº
[âœ“] trigger_test      (1.1 MB)
[âœ“] camera_test
[âœ“] daheng_camera_test
...
```

å…¨éƒ¨ç¼–è¯‘é€šè¿‡ï¼Œæ— è­¦å‘Šæ— é”™è¯¯ã€‚

---

## ğŸ¨ ä»£ç é£æ ¼

### éµå¾ªé¡¹ç›®è§„èŒƒ
- âœ… ä½¿ç”¨é¡¹ç›®ç»Ÿä¸€çš„æ—¥å¿—ç³»ç»Ÿ (`tools::logger()`)
- âœ… ä½¿ç”¨YAMLé…ç½®æ–‡ä»¶åŠ è½½å‚æ•°
- âœ… æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- âœ… é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ—¥å¿—å®Œå–„
- âœ… å‘åå…¼å®¹ï¼Œé»˜è®¤å…³é—­æ–°åŠŸèƒ½

### ä»£ç è´¨é‡
```cpp
// âœ… å‚æ•°éªŒè¯
switch (trigger_source_) {
    case 0: ... break;
    case 1: ... break;
    case 2: ... break;
    default:
        tools::logger()->warn("Invalid trigger_source {}, using Line0", trigger_source_);
        break;
}

// âœ… è¯¦ç»†æ—¥å¿—
tools::logger()->info(
    "Daheng external trigger enabled: source={} ({}), activation={} ({})",
    trigger_source_, line_name,
    trigger_activation_,
    trigger_activation_ == 0 ? "RisingEdge" : "FallingEdge"
);
```

---

## ğŸ“š æ–‡æ¡£å®Œæ•´æ€§

### ç”¨æˆ·æ–‡æ¡£
- âœ… é…ç½®å‚æ•°è¯´æ˜ï¼ˆYAMLæ³¨é‡Šï¼‰
- âœ… è¯¦ç»†ä½¿ç”¨æŒ‡å—ï¼ˆ`TRIGGER_GUIDE.md`ï¼‰
  - æ¦‚è¿°å’Œåº”ç”¨åœºæ™¯
  - å‚æ•°è¯¦è§£
  - ç¡¬ä»¶è¿æ¥æŒ‡å—
  - ä½¿ç”¨ç¤ºä¾‹
  - æ•…éšœæ’æŸ¥
  - æ€§èƒ½å‚è€ƒ

### å¼€å‘æ–‡æ¡£
- âœ… å®ç°è¯´æ˜ï¼ˆ`TRIGGER_IMPLEMENTATION.md`ï¼‰
  - ä¿®æ”¹æ–‡ä»¶æ¸…å•
  - ä»£ç é€»è¾‘è¯´æ˜
  - å¿«é€Ÿå¼€å§‹æŒ‡å—
  - æµ‹è¯•é¡¹ç›®æ¸…å•

---

## ğŸ§ª æµ‹è¯•ç¨‹åºåŠŸèƒ½

`trigger_test` ç¨‹åºæä¾›ï¼š

- [x] è‡ªåŠ¨æ£€æµ‹å½“å‰é…ç½®æ¨¡å¼
- [x] è¿ç»­æ¨¡å¼æµ‹è¯•
  - å®æ—¶å¸§ç‡æ˜¾ç¤º
  - å›¾åƒé¢„è§ˆçª—å£
  - ä¿å­˜å›¾åƒåŠŸèƒ½ (æŒ‰'s'é”®)
- [x] ç¡¬è§¦å‘æ¨¡å¼æµ‹è¯•
  - è§¦å‘é—´éš”æ˜¾ç¤º
  - è§¦å‘è®¡æ•°æ˜¾ç¤º
  - å›¾åƒé¢„è§ˆçª—å£
  - ä¿å­˜å›¾åƒåŠŸèƒ½

**è¿è¡Œæ•ˆæœç¤ºä¾‹**:
```bash
$ ./build/trigger_test

[info] === å¤§æ’ç›¸æœºç¡¬è§¦å‘æµ‹è¯•ç¨‹åº ===
[info] é…ç½®æ–‡ä»¶: configs/daheng.yaml
[info] è§¦å‘æ¨¡å¼é…ç½®:
[info]   trigger_enable: false (è¿ç»­é‡‡é›†)
[info]
[info] æ­£åœ¨åˆå§‹åŒ–ç›¸æœº...
[info] Daheng library initialized successfully
[info] Found 1 Daheng camera(s)
[info] Daheng camera configured in continuous mode (trigger disabled)
[info] ç›¸æœºåˆå§‹åŒ–æˆåŠŸï¼
[info]
[info] === è¿ç»­é‡‡é›†æ¨¡å¼æµ‹è¯• ===
[info] ç›¸æœºå°†è‡ªåŠ¨è¿ç»­é‡‡é›†å›¾åƒ
[info] æŒ‰ 'q' é”®é€€å‡ºï¼Œ's' é”®ä¿å­˜å›¾åƒ
[info]
[info] å¸§æ•°: 30, å¹³å‡å¸§ç‡: 168.25 FPS
[info] å¸§æ•°: 60, å¹³å‡å¸§ç‡: 167.89 FPS
...
```

---

## ğŸ” ä»£ç æ”¹åŠ¨ç»Ÿè®¡

```
æ–‡ä»¶ä¿®æ”¹ï¼š
  io/daheng.hpp                      +3 è¡Œ
  io/daheng.cpp                      +110 è¡Œ
  configs/daheng.yaml                +14 è¡Œ
  CMakeLists.txt                     +3 è¡Œ

æ–°å¢æ–‡ä»¶ï¼š
  tests/trigger_test.cpp             +157 è¡Œ
  docs/TRIGGER_GUIDE.md              +310 è¡Œ
  docs/TRIGGER_IMPLEMENTATION.md     +280 è¡Œ

æ€»è®¡ï¼š
  ä¿®æ”¹ 4 ä¸ªæ–‡ä»¶
  æ–°å¢ 3 ä¸ªæ–‡ä»¶
  ä»£ç æ–°å¢çº¦ 877 è¡Œ
```

---

## âœ¨ äº®ç‚¹ç‰¹æ€§

### 1. é›¶ä¾µå…¥è®¾è®¡
```yaml
# é»˜è®¤é…ç½®ä¸å˜ï¼Œç°æœ‰ç³»ç»Ÿæ— å½±å“
trigger_enable: false  # é»˜è®¤å…³é—­
```

### 2. çµæ´»é…ç½®
```yaml
# 3ä¸ªGPIOæº Ã— 2ç§è§¦å‘æ²¿ = 6ç§ç»„åˆ
trigger_source: 0/1/2
trigger_activation: 0/1
```

### 3. å®Œå–„çš„æ—¥å¿—
```cpp
// æˆåŠŸæ—¥å¿—
[info] Daheng external trigger enabled: source=2 (Line2), activation=0 (RisingEdge)

// é”™è¯¯æ—¥å¿—
[warn] Failed to set trigger mode ON
[warn] Invalid trigger_source 5, using Line0
```

### 4. å¥å£®çš„é”™è¯¯å¤„ç†
```cpp
// å‚æ•°è¶Šç•Œå¤„ç†
default:
    src_entry = GX_TRIGGER_SOURCE_LINE0;
    tools::logger()->warn("Invalid trigger_source {}, using Line0", trigger_source_);
    break;
```

---

## ğŸ“ å­¦ä¹ å‚è€ƒ

### è§¦å‘æ¨¡å¼å¯¹æ¯”

| ç‰¹æ€§ | è¿ç»­æ¨¡å¼ | ç¡¬è§¦å‘æ¨¡å¼ |
|------|----------|-----------|
| é‡‡é›†æ–¹å¼ | è½¯ä»¶è‡ªç”±é‡‡é›† | ç¡¬ä»¶ä¿¡å·è§¦å‘ |
| åŒæ­¥ç²¾åº¦ | è½¯ä»¶çº§ (~ms) | ç¡¬ä»¶çº§ (<1ms) |
| é€‚ç”¨åœºæ™¯ | æ™®é€šè§†è§‰ä»»åŠ¡ | ç²¾ç¡®åŒæ­¥åœºæ™¯ |
| é…ç½®å¤æ‚åº¦ | ä½ | ä¸­ |
| ç¡¬ä»¶è¦æ±‚ | æ—  | éœ€è§¦å‘ä¿¡å·æº |

### åº”ç”¨åœºæ™¯ç¤ºä¾‹

**åœºæ™¯1ï¼šäº‘å°IMUåŒæ­¥**
```
äº‘å°æ¯æ¬¡åˆ°è¾¾ç›®æ ‡ä½ç½® â†’ è§¦å‘ç›¸æœºé‡‡é›†
å¥½å¤„ï¼šå›¾åƒä¸å§¿æ€ç²¾ç¡®å¯¹åº”ï¼Œå‡å°‘è¿åŠ¨æ¨¡ç³Š
```

**åœºæ™¯2ï¼šå¤šç›¸æœºåŒæ­¥**
```
å•ä¸ªè§¦å‘æº â†’ åŒæ—¶è§¦å‘å¤šå°ç›¸æœº
å¥½å¤„ï¼šå®ç°å®Œå…¨åŒæ­¥çš„åŒç›®/å¤šç›®è§†è§‰
```

**åœºæ™¯3ï¼šç¼–ç å™¨åŒæ­¥**
```
äº‘å°æ—‹è½¬åˆ°ç‰¹å®šè§’åº¦ â†’ è§¦å‘é‡‡é›†
å¥½å¤„ï¼šå›ºå®šè§’åº¦é—´éš”é‡‡é›†ï¼Œä¾¿äºæ‹¼æ¥
```

---

## ğŸ”® æœªæ¥æ‰©å±•

å¯èƒ½çš„åŠŸèƒ½æ‰©å±•æ–¹å‘ï¼š

1. **è½¯ä»¶è§¦å‘**
   - æ·»åŠ GX_TRIGGER_SOURCE_SOFTWARE
   - é€šè¿‡APIä¸»åŠ¨è§¦å‘

2. **é—ªå…‰ç¯åŒæ­¥**
   - é…ç½®Lineè¾“å‡ºæ¨¡å¼
   - è§¦å‘æ—¶åŒæ—¶é—ªå…‰

3. **è§¦å‘å»¶è¿Ÿ**
   - æ·»åŠ trigger_delayå‚æ•°
   - æ”¯æŒè§¦å‘åå»¶è¿Ÿæ›å…‰

4. **è§¦å‘è®¡æ•°å™¨**
   - ç»Ÿè®¡è§¦å‘æ¬¡æ•°
   - æ£€æµ‹ä¸¢å¸§æƒ…å†µ

---

## ğŸ™ è‡´è°¢

å‚è€ƒäº†åŒæµå¤§å­¦SuperPoweræˆ˜é˜Ÿçš„ç›¸æœºè§¦å‘å®ç°ä»£ç ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œäº†ï¼š
- ä»£ç ç»“æ„ä¼˜åŒ–
- é”™è¯¯å¤„ç†å¢å¼º
- æ–‡æ¡£è¡¥å……å®Œå–„
- æµ‹è¯•ç¨‹åºå¼€å‘

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥é˜…ï¼š
1. `docs/TRIGGER_GUIDE.md` - è¯¦ç»†ä½¿ç”¨æŒ‡å—
2. `docs/TRIGGER_IMPLEMENTATION.md` - å®ç°è¯´æ˜
3. é¡¹ç›®issueè·Ÿè¸ªç³»ç»Ÿ

---

**é¡¹ç›®**: SP_vision_USB
**åŠŸèƒ½**: å¤§æ’ç›¸æœºç¡¬è§¦å‘
**çŠ¶æ€**: âœ… å®Œæˆ
**æ—¥æœŸ**: 2025-12-09
**ç‰ˆæœ¬**: v1.0
